<!DOCTYPE html>
<html>
<title>Projet InfoVis</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src=".https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script type="text/javascript" src="psd3.js"></script>
<link rel="stylesheet" type="text/css" href="psd3.css" />

<style>
html,body,h1,h2,h3,h4,h5 {font-family: "Raleway", sans-serif}
.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}
 
.bar {
  fill: steelblue;
}
 
.x.axis path {
  display: none;
}
</style>
<body class="w3-light-grey">

<!-- Top container -->
<div class="w3-bar w3-top w3-black w3-large" style="z-index:4">
  <button class="w3-bar-item w3-button w3-hide-large w3-hover-none w3-hover-text-light-grey" onclick="w3_open();"><i class="fa fa-bars"></i>  Menu</button>
  <span class="w3-bar-item w3-right">InfoVis 21/22</span>
</div>

<!-- Sidebar/menu -->
<nav class="w3-sidebar w3-collapse w3-white w3-animate-left" style="z-index:3;width:235px;" id="mySidebar"><br>
  <div class="w3-container w3-row">
    <div class="w3-col s4">
      <img src="image1.png" class="w3-margin-right" style="width:60px">
    </div>
    <div class="w3-col s8 w3-bar">
      <span>Bienvenue, <strong>Wizard</strong></span><br>
      <a href="https://github.com/sami15as42" class="w3-bar-item w3-button"><i class="fa fa-github"></i></a>
      <a href="https://www.linkedin.com/in/mohamed-sami-assenine/" class="w3-bar-item w3-button"><i class="fa fa-linkedin"></i></a>
    </div>
  </div>
  <hr>
  <div class="w3-container">
    <h5>Dashboard</h5>
  </div>
  <div class="w3-bar-block">
    <a href="#" class="w3-bar-item w3-button w3-padding-16 w3-hide-large w3-dark-grey w3-hover-black" onclick="w3_close()" title="close menu"><i class="fa fa-remove fa-fw"></i>  Close Menu</a>
    <a href="#chart1" class="w3-bar-item w3-button w3-padding w3-blue"><i class="fa fa-bar-chart fa-fw"></i>  Grouped Stacked Bar Chart</a>
    <a href="#chart2" class="w3-bar-item w3-button w3-padding"><i class="fa fa-pie-chart fa-fw"></i>  Hierarchical Pie Chart</a>
  </div>
</nav>


<!-- Overlay effect when opening sidebar on small screens -->
<div class="w3-overlay w3-hide-large w3-animate-opacity" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

<!-- !PAGE CONTENT! -->
<div class="w3-main" style="margin-left:235px;margin-top:43px;">

  <!-- Header -->
  <header class="w3-container" style="padding-top:22px">
    <h5><b><i class="fa fa-dashboard"></i> Dashboard</b></h5>
  </header>

  <div id="chart1" class="w3-container">
    <h5>Grouped Stacked Bar Chart</h5>
    <div id="chart" class="w3-card-4 w3-white" style="font: 10px sans-serif">
    </div>
  </div>
  <hr>

  <div id="chart2" class="w3-container">
    <h5>Hierarchical Pie Chart</h5>
    <div>
      <div id="chartContainer" class="w3-card-4 w3-white w3-half" style="width: 500px;"></div>
      <div class="w3-card-4 w3-white w3-half" style="width: 300px; margin-left: 150px; text-align: center;"><span>Double-cliquez sur une tranche d'âge (cercle le plus interne) pour afficher une vue plus détaillée</span></div>
    </div>
  </div>
  <hr>

  <br>
  <div class="w3-container w3-dark-grey w3-padding-32">
    <div class="w3-row">
      <div class="w3-container w3-third">
        <h5 class="w3-bottombar w3-border-green">ASSENINE Mohamed Sami</h5>
        <p><strong>Groupe :</strong> MSQ2</p>
        <p><strong>Adresse mail :</strong> hm_assenine@esi.dz</p>
      </div>
      <div class="w3-container w3-third">
        <h5 class="w3-bottombar w3-border-red">ABDALLAH Farouk</h5>
        <p><strong>Groupe :</strong> MSQ2</p>
        <p><strong>Adresse mail :</strong> hf_abdallah@esi.dz</p>
      </div>
      <div class="w3-container w3-third">
        <h5 class="w3-bottombar w3-border-orange">LAGHOUB Nassim</h5>
        <p><strong>Groupe :</strong> MSL</p>
        <p><strong>Adresse mail :</strong> hn_laghoub@esi.dz</p>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="w3-container w3-padding-16 w3-light-grey">
    <h4>Projet InfoVis 21/22</h4>
    <p>Novembre 2021, Copyright ©</a></p>
  </footer>

  <!-- End page content -->
</div>




    <script type="text/javascript">
        var sampleData = [
        {
            noOfColleges: 76,
            place: "1",
            drilldown: [{
                noOfColleges: 28,
                place: "DIABETE",
                drilldown: [{
                    noOfColleges: 10,
                    place: "HM",
                    drilldown: [ {noOfColleges: 10 ,place: "NF",drilldown: []} ]                   
                }, {
                    noOfColleges: 18,
                    place: "FM",
                    drilldown: [ {noOfColleges: 18 ,place: "NF",drilldown: []}]
                }]
            }, {
                noOfColleges: 5,
                place: "ASTHME",
                drilldown: [{
                    noOfColleges: 2,
                    place: "HM",
                    drilldown: [ {noOfColleges: 2 ,place: "NF",drilldown: []} ]                   
                }, {
                    noOfColleges: 3,
                    place: "FM",
                    drilldown: [ {noOfColleges: 3 ,place: "NF",drilldown: []}]
                }]
            }, {
                noOfColleges: 4,
                place: "CARDIO",
                 drilldown: [{
                    noOfColleges: 1,
                    place: "HM",
                    drilldown: [ {noOfColleges: 1 ,place: "NF",drilldown: []} ]                   
                }, {
                    noOfColleges: 3,
                    place: "FM",
                    drilldown: [ {noOfColleges: 3 ,place: "NF",drilldown: []}]
                }]
            }, {
                noOfColleges: 22,
                place: "HTA",
                drilldown: [{
                    noOfColleges: 10,
                    place: "HM",
                    drilldown: [ {noOfColleges: 1 ,place: "F",drilldown: []} , {noOfColleges: 9 ,place: "NF",drilldown: []} ]                   
                }, {
                    noOfColleges: 12,
                    place: "FM",
                    drilldown: [ {noOfColleges: 12 ,place: "NF",drilldown: []}]
                }]
            }, {
                noOfColleges: 26,
                place: "RIEN",
                drilldown: [{
                    noOfColleges: 16,
                    place: "HM",
                    drilldown: [ {noOfColleges: 1 ,place: "F",drilldown: []} , {noOfColleges: 15 ,place: "NF",drilldown: []} ]                   
                }, {
                    noOfColleges: 10,
                    place: "FM",
                    drilldown: [ {noOfColleges: 10 ,place: "NF",drilldown: []}]
                }]
            }]



        },{
            noOfColleges: 22,
            place: "2",
            drilldown: [{
                noOfColleges: 9,
                place: "DIABETE",
                drilldown: [{
                    noOfColleges: 6,
                    place: "HM",
                    drilldown: [ {noOfColleges: 2 ,place: "F",drilldown: []},{noOfColleges: 3 ,place: "NF",drilldown: []} ]                   
                }, {
                    noOfColleges: 3,
                    place: "FM",
                    drilldown: [ {noOfColleges: 3 ,place: "NF",drilldown: []}]
                }]
            }, {
                noOfColleges: 1,
                place: "ASTHME",
                drilldown: [{
                    noOfColleges: 1,
                    place: "HM",
                    drilldown: [ {noOfColleges: 1 ,place: "NF",drilldown: []} ]                   
                }]
            }, {
                noOfColleges: 1,
                place: "CARDIO",
                 drilldown: [{
                    noOfColleges: 1,
                    place: "FM",
                    drilldown: [ {noOfColleges: 1 ,place: "NF",drilldown: []}]
                }]
            }, {
                noOfColleges: 7,
                place: "HTA",
                drilldown: [{
                    noOfColleges: 5,
                    place: "HM",
                    drilldown: [ {noOfColleges: 1 ,place: "F",drilldown: []} , {noOfColleges: 4 ,place: "NF",drilldown: []} ]                   
                }, {
                    noOfColleges: 2,
                    place: "FM",
                    drilldown: [ {noOfColleges: 2 ,place: "NF",drilldown: []}]
                }]
            }, {
                noOfColleges: 6,
                place: "RIEN",
                drilldown: [{
                    noOfColleges: 5,
                    place: "HM",
                    drilldown: [ {noOfColleges: 1 ,place: "F",drilldown: []} , {noOfColleges: 4 ,place: "NF",drilldown: []} ]                   
                }, {
                    noOfColleges: 1,
                    place: "FM",
                    drilldown: [ {noOfColleges: 1 ,place: "NF",drilldown: []}]
                }]
            }]
        },



        {
            noOfColleges: 4,
            place: "3",
            drilldown: [{
                noOfColleges: 4,
                place: "RIEN",
                drilldown: [{
                    noOfColleges: 4,
                    place: "HM",
                    drilldown: [ {noOfColleges: 1 ,place: "F",drilldown: []},{noOfColleges: 3 ,place: "NF",drilldown: []} ]                   
                }]
            }]
        },

        {
            noOfColleges: 3,
            place: "4",
            drilldown: [{
                noOfColleges: 2,
                place: "RIEN",
                drilldown: [{
                    noOfColleges: 2,
                    place: "FM",
                    drilldown: [ {noOfColleges: 2 ,place: "NF",drilldown: []} ]                   
                }]
            },{
                noOfColleges: 1,
                place: "DIABETE",
                drilldown: [{
                    noOfColleges: 1,
                    place: "HM",
                    drilldown: [ {noOfColleges: 1 ,place: "NF",drilldown: []} ]                   
                }]
            }]
        },

                {
            noOfColleges: 1,
            place: "5",
            drilldown: [{
                noOfColleges: 1,
                place: "DIABETE",
                drilldown: [{
                    noOfColleges: 1,
                    place: "FM",
                    drilldown: [ {noOfColleges: 1 ,place: "NF",drilldown: []} ]                   
                }]
            }]
        }




        ];

        var config = {
            containerId: "chartContainer",
            width: 500,
            height: 500,
            data: sampleData,
            heading: {
                text: "Répartition des personnes par tanches d'age, genre, maladie et leur consommation de tabac",
                pos: "top"
            },
            label: function(d) {
                return d.data.place ;
            },
            value: "noOfColleges",
            inner: "drilldown",
            tooltip: function(d) {
                var text = ""
                switch(d.place) {
                    case "F":
                      text = "Fumeur";
                      break;
                    case "NF":
                      text = "Non Fumeur";
                      break;
                    case "HM":
                      text = "Homme"; 
                      break;
                    case "FM":
                      text = "Femme";
                      break;
                    case "1":
                      text = "La tranche d'age [18,27]";
                      break;
                    case "2":
                      text = "La tranche d'age [28,37]";
                      break;
                    case "3":
                      text = "La tranche d'age [38,47]";
                      break;
                    case "4":
                      text = "La tranche d'age [48,57]";
                      break;
                    case "5":
                      text = "La tranche d'age [58,67]";
                      break;
                    default:
                      text = d.place;
                }
                return "<div style='background-color: grey; color: white; padding: 10px; text-align: center; border: dotted 1px black;'><strong>" + text + "</strong>: " + d.noOfColleges + " personne(s)</div>";
            },
            transition: "linear",
            transitionDuration: 400,
            donutRadius: 50,
            gradient: true,
            colors: d3.scale.category20(),
            labelColor: "white",
            stroke: "#eee",
            strokeWidth: 3,
            drilldownTransition: "linear",
            drilldownTransitionDuration: 0,
            highlightColor: "#c00"
        };

        var samplePie = new psd3.Pie(config);
    </script>

<script>
// Get the Sidebar
var mySidebar = document.getElementById("mySidebar");

// Get the DIV with overlay effect
var overlayBg = document.getElementById("myOverlay");

// Toggle between showing and hiding the sidebar, and add overlay effect
function w3_open() {
  if (mySidebar.style.display === 'block') {
    mySidebar.style.display = 'none';
    overlayBg.style.display = "none";
  } else {
    mySidebar.style.display = 'block';
    overlayBg.style.display = "block";
  }
}

// Close the sidebar with the close button
function w3_close() {
  mySidebar.style.display = "none";
  overlayBg.style.display = "none";
}
</script>

<script>
var margin = {top: 30, right: 20, bottom: 50, left: 50},
    width = 1080 - margin.left - margin.right,
    height = 510 - margin.top - margin.bottom;
 
var x0 = d3.scale.ordinal()
    .rangeRoundBands([0, width], 0.1);
 
var x1 = d3.scale.ordinal();
 
var y = d3.scale.linear()
    .range([height, 0]);
 
var xAxis = d3.svg.axis()
    .scale(x0)
    .orient("bottom");
 
var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .tickFormat(d3.format(".2s"));
 
var color = d3.scale.ordinal()
    .range(["#98abc5", "#6b486b", "#a05d56", "#ff8c00"]);
 
var svg = d3.select("#chart").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
 
var yBegin;
 
var innerColumns = {
  "column1" : ["CardioHF","CardioHf","CardioFF","CardioFf"],
  "column2" : ["HTAHF","HTAHf","HTAFF","HTAFf"],
  "column3" : ["DiabeteHF","DiabeteHf","DiabeteFF","DiabeteFf"],
  "column4" : ["AsthmeHF","AsthmeHf","AsthmeFF","AsthmeFf"],
  "column5" : ["RienHF","RienHf","RienFF","RienFf"]
}
 
d3.csv("data.csv", function(error, data) {
  var columnHeaders = d3.keys(data[0]).filter(function(key) { return key !== "State"; });
  color.domain(d3.keys(data[0]).filter(function(key) { return key !== "State"; }));
  data.forEach(function(d) {
    var yColumn = new Array();
    d.columnDetails = columnHeaders.map(function(name) {
      for (ic in innerColumns) {
        if($.inArray(name, innerColumns[ic]) >= 0){
          if (!yColumn[ic]){
            yColumn[ic] = 0;
          }
          yBegin = yColumn[ic];
          yColumn[ic] += +d[name];
          var num = 0;
          if ((name=="CardioHF")||(name=="HTAHF")||(name=="DiabeteHF")||(name=="AsthmeHF")||(name=="RienHF")) num = 1;
          if ((name=="CardioHf")||(name=="HTAHf")||(name=="DiabeteHf")||(name=="AsthmeHf")||(name=="RienHf")) num = 2;
          if ((name=="CardioFF")||(name=="HTAFF")||(name=="DiabeteFF")||(name=="AsthmeFF")||(name=="RienFF")) num = 3;
          if ((name=="CardioFf")||(name=="HTAFf")||(name=="DiabeteFf")||(name=="AsthmeFf")||(name=="RienFf")) num = 4;
          return {name: name, column: ic, yBegin: yBegin, yEnd: +d[name] + yBegin, bg: num};
        }
      }
    });
    d.total = d3.max(d.columnDetails, function(d) { 
      return d.yEnd; 
    });
  });

  x0.domain(data.map(function(d) { return d.State; }));
  x1.domain(d3.keys(innerColumns)).rangeRoundBands([0, x0.rangeBand()]);
 
  y.domain([0, d3.max(data, function(d) { 
    return d.total; 
  })]);
  ///////////////////////////////   Titres  ////////////////////////////////////////////////
  var ytext = [];
  var index = [3, 7, 11, 15, 19];
  var x_bar = [21, 63, 89, 127, 167]; //position des colonnes dans chaque tranche d'ages
  var maladies = ["Cardio", "HTA", "Diabete", "Asthm", "Rien"];
  for (i = 0; i < data.length; i++) {
    for (j = 0; j < index.length; j++) {
      if (data[i].columnDetails[index[j]]!=null) ytext.push([x_bar[j]+(i)*198, y(data[i].columnDetails[index[j]].yEnd)]);
    }
  }
  for (i = 0; i < ytext.length; i++) {
    svg.append("text")
        .attr("x", ytext[i][0])
        .attr("y", ytext[i][1]-10)
        .attr("font-size", "20em")
        .text(maladies[i%maladies.length]);
  }
  /////////////////////////////////////////////////////////////////////////////////////////
  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis)
      .append("text")
      .attr("transform", "rotate(0)")
      .attr("y", 10)
      .attr("x", width+20)
      .attr("dy", ".7em")
      .style("text-anchor", "end")
      .text("Tranches d'âge");
 
  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
      .append("text")
      .attr("transform", "rotate(180)")
      .attr("y", 6)
      .attr("dy", ".7em")
      .style("text-anchor", "end")
      .text("%");

  //////////////////////////////////// Background Image //////////////////////////////
  svg.append("defs")
    .append("pattern")
    .attr("x", 0)
    .attr("y", 0)
    .attr("width", 10)
    .attr("height", 10)
    .attr("id", "bg_pink")
    .append("image")
        .attr("x", 0).attr("y", -40)
        .attr("width", 800)
        .attr("height", 500)
        .attr("xlink:href", "Pink.PNG");
  svg.append("defs")
    .append("pattern")
    .attr("x", 0)
    .attr("y", 0)
    .attr("width", 10)
    .attr("height", 10)
    .attr("id", "bg_pink_t")
    .append("image")
        .attr("x", 0).attr("y", -40)
        .attr("width", 800)
        .attr("height", 500)
        .attr("xlink:href", "Pink_t.PNG");
  svg.append("defs")
    .append("pattern")
    .attr("x", 0)
    .attr("y", 0)
    .attr("width", 10)
    .attr("height", 10)
    .attr("id", "bg_blue")
    .append("image")
        .attr("x", 0).attr("y", -40)
        .attr("width", 800)
        .attr("height", 500)
        .attr("xlink:href", "Blue.PNG");
  svg.append("defs")
    .append("pattern")
    .attr("x", 0)
    .attr("y", 0)
    .attr("width", 10)
    .attr("height", 10)
    .attr("id", "bg_blue_t")
    .append("image")
        .attr("x", 0).attr("y", -40)
        .attr("width", 800)
        .attr("height", 500)
        .attr("xlink:href", "Blue_t.PNG");
  svg.append("defs")
    .append("pattern")
    .attr("x", 0)
    .attr("y", 0)
    .attr("width", 10)
    .attr("height", 10)
    .attr("id", "bg_white_t")
    .append("image")
        .attr("x", 0).attr("y", -40)
        .attr("width", 800)
        .attr("height", 500)
        .attr("xlink:href", "White_t.png");
  ////////////////////////////////////////////////////////////////////////////////////
 
  var project_stackedbar = svg.selectAll(".project_stackedbar")
      .data(data)
      .enter().append("g")
      .attr("class", "g")
      .attr("transform", function(d) { return "translate(" + x0(d.State) + ",0)"; });
 
  project_stackedbar.selectAll("rect")
      .data(function(d) { return d.columnDetails; })
      .enter().append("rect")
      .attr("width", x1.rangeBand())
      .attr("stroke", "black")  ////////la couleur des contours
      .attr("stroke-width", 0.8)  ////////la couleur des contours
      .attr("x", function(d) { return x1(d.column);})
      .attr("y", function(d) { return y(d.yEnd); })
      .attr("height", function(d) { return y(d.yBegin) - y(d.yEnd); })
      .attr("fill", function(d) {  //Image background
          switch(d.bg) {
            case 1:
              return "url(#bg_blue_t)";
              break;
            case 2:
              return "url(#bg_blue)";
              break;
            case 3:
              return "url(#bg_pink_t)";
              break;
            case 4:
              return "url(#bg_pink)";
              break;
            default:
              break;
          }
      })
      .on("mouseover", function() { tooltip.style("display", "inline-block"); })
      .on("mouseout", function() { tooltip.style("display", "none"); })
      .on("mousemove", function(d) {
        var xPosition = event.clientX - 310;
        var yPosition = d3.mouse(this)[1] - 27;
        tooltip.attr("transform", "translate(" + xPosition + "," + yPosition + ")");
        var info1 = "";
        if (d.name.slice(-2,-1)=="H") {
          info1 += "Les hommes ";
          if (d.name.slice(-1,d.name.length)=="F") info1 += "fumeurs";
          else info1 += "non fumeurs"; 
        }
        else {
          info1 += "Les femmes ";
          if (d.name.slice(-1,d.name.length)=="F") info1 += "fumeuses";
          else info1 += "non fumeuses";
        }
        var info2 = "";
        if (d.name.slice(0,-2)=="Rien") info2 += "qui n'ont rien : " + (d.yEnd-d.yBegin) + "%";
        else info2 += "qui ont " + d.name.slice(0,-2) + " : " + (d.yEnd-d.yBegin) + "%";
        tooltip.select("#text1").text(info1);
        tooltip.select("#text2").text(info2);
      });

      var tooltip = svg.append("g")
        .style("display", "none");
          
      tooltip.append("rect")
        .attr("x", -75)
        .attr("y", -15)
        .attr("width", 170)
        .attr("height", 35)
        .attr("fill", "gray")
        .attr("rx", 10)
        .attr("ry", 10)
        .style("opacity", 0.9);

      tooltip.append("text")
        .attr("id", "text1")
        .attr("x", 10)
        .attr("dy", "0em")
        .style("text-anchor", "middle")
        .attr("font-size", "12px")
        .attr("font-weight", "bold");

      tooltip.append("text")
        .attr("id", "text2")
        .attr("x", 10)
        .attr("dy", "1em")
        .style("text-anchor", "middle")
        .attr("font-size", "12px")
        .attr("font-weight", "bold");
 
      svg.append('text')
          .attr('x', -215)
          .attr('y', -33)
          .attr('transform', 'rotate(-90)')
          .attr('text-anchor', 'middle')
          .attr("font-size", "12px")
          .text('Pourcentage des personnes (%)');

      svg.append('text')
          .attr('x', 508)
          .attr('y', 470)
          .attr('text-anchor', 'middle')
          .text("Répartition du pourcentage des personnes par genre, maladie et leur consommation de tabac pour chaque tanche d'age");

  var legend = svg.selectAll(".legend")
      .data([{legend: "Homme", bg:1}, {legend: "Femme", bg:2}, {legend: "Fumeur", bg:3}, {legend: "Non Fumeur", bg:4}])
      .enter().append("g")
      .attr("class", "legend")
      .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });
 
  legend.append("rect")
      .attr("x", width)
      .attr("stroke", "black")
      .attr("stroke-width", 0.4)
      .attr("width", 18)
      .attr("height", 18)
      .attr("fill", function(d) {  //Image background
          switch(d.bg) {
            case 1:
              return "url(#bg_blue)";
              break;
            case 2:
              return "url(#bg_pink)";
              break;
            case 3:
              return "url(#bg_white_t)"; 
              break;
            case 4:
              return "url()";
              break;
            default:
              break;
          }
      });
 
  legend.append("text")
      .attr("x", width - 6)
      .attr("y", 9)
      .attr("dy", ".35em")
      .style("text-anchor", "end")
      .text(function(d) { return d.legend; });
 
});
 
</script>

</body>
</html>